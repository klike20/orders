<html>
<head>
<link rel="stylesheet" type="text/css" href="orderscont.css">
<style>
</style>
<script src="jquery-3.3.1.min.js"></script>
<script>
$( document ).ready(function() {
	
var userId = "";
var companyId = "";
var officeId = "";
	
var i = 0;
/*var myusername = $("#username").val();
$.ajax({
  type: "GET",
  url: "rest/companies",
  data: myusername,
  cache: false,
  success: function(data){
     $("#resultarea").text(data);
  }
});*/

var x = document.getElementsByTagName("BODY")[0];
x.style.backgroundColor = "#F5F5E7";

$( "#headerBar" ).hide();
$( "#loginDiv" ).hide();
$( "#registerDiv" ).hide();
$( "#productsDiv" ).hide();
$( "#productDiv" ).hide();

setTimeout(function() {
	x.style.backgroundColor = "white";
	$( "#initScreen" ).hide();

	$( "#title" ).html("Iniciar Sesi&oacute;n");
	$( "#headerBar" ).show();
	$( "#loginDiv" ).show();
}, 1500);


//-------------------- LOGIN BUTTON ------------------------
$( "#login" ).click(function() {
	var username = $("#username").val();
	var password = $("#password").val();
	var theData = username+","+password;
	$.ajax({
		  type: "GET",
		  url: "http://ec2-18-219-170-84.us-east-2.compute.amazonaws.com:8080/orders/rest/user",
		  xhrFields: {
			    // The 'xhrFields' property sets additional fields on the XMLHttpRequest.
			    // This can be used to set the 'withCredentials' property.
			    // Set the value to 'true' if you'd like to pass cookies to the server.
			    // If this is enabled, your server must respond with the header
			    // 'Access-Control-Allow-Credentials: true'.
			    withCredentials: false
		  	},
		  data: "data="+theData,
		  cache: false,
		  success: function(data){
		     $("#resultarea").text(data);
		     if (data == "failed") {
		    	 	$("#resultarea").text("El usuario no existe");
		     } else {
		    	    var array = data.split(',')
		    	 	userId = array[0];
		    	    officeId = array[1];
		    		$( "#loginDiv" ).hide();
		    		$( "#productsDiv" ).show();
		     }
		  }
		});
});
	
	
//-------------------- REGISTER PAGE ------------------------
$( "#register" ).click(function() {
	
	$( "#cellphone" ).prop( "disabled", true );
	$( "#phone" ).prop( "disabled", true );
	$( "#email" ).prop( "disabled", true );
	
	$( "#loginDiv" ).hide();

	$( "#title" ).text("Registro");
	$( "#registerDiv" ).show();
});

$( "#idEmpRecep" ).change(function() {
	validateCompany();
});

$( "#passEmpRecep" ).change(function() {
	validateCompany();
});

function validateCompany() {
	var username = $("#idEmpRecep").val();
	var password = $("#passEmpRecep").val();
	
	if (username != null && password != null) {
		$( "#cellphone" ).val("");
		$( "#phone" ).val("");
		$( "#email" ).val("");
		var theData = username+","+password;
		$.ajax({
			  type: "GET",
			  url: "rest/company",
			  data: "data="+theData,
			  cache: false,
			  success: function(data){
			     if (data == "failed") {
			    	 	companyId = "";
			    		$( "#cellphone" ).prop( "disabled", true );
			    		$( "#phone" ).prop( "disabled", true );
			    		$( "#email" ).prop( "disabled", true );
			    		
			    		$('#office').empty();
			    		
			     } else {
			    	 	companyId = data;
			    		$( "#cellphone" ).prop( "disabled", false );
			    		$( "#phone" ).prop( "disabled", false );
			    		$( "#email" ).prop( "disabled", false );
			    		
			    		$.ajax({
				  			  type: "GET",
				  			  url: "rest/company/office",
				  			  data: "company="+companyId,
				  			  cache: false,
				  			  success: function(data){
				  			     if (data == "failed") {
				  			    		//Show a message with the issue
				  			     } else {
				  			    	 	if (data != "") {
				  			    	 		var arrayOffices = data.split(';');
				  			    	 		$.each(arrayOffices, function( index, value ) {
				  			    	 		  	//alert( index + ": " + value );
				  			    	 		  	if (value != "") {
					  			    	 			var officeData = value.split(',');
					  			    	 			currentOfficeId = officeData[0];
						  				    	    currentOfficeName = officeData[1];
							  				    	var o = new Option(currentOfficeName, currentOfficeId);
							  				    	/// jquerify the DOM object 'o' so we can use the html method
							  				    	$(o).html(currentOfficeName);
							  				    	$("#office").append(o);
				  			    	 			}
				  			    	 		});
				  			    	 	} else {
				  			    	 		//alert( "Empty!" );
				  			    	 		$('#office').empty();
				  			    	 	}
				  			     }
				  			  }
				  			});
			    		
			     }
			  }
			});
	}
}


//-------------------- REGISTER BUTTON ------------------------
$( "#submitRegister" ).click(function() {
	
	var idUser = $("#idUser").val();
	var pass = $("#pass").val();
	var office = $("#office").val();
	var cellphone = $("#cellphone").val();
	var phone = $("#phone").val();
	var email = $("#email").val();
	
	var theData = idUser+","+pass+","+cellphone+","+phone+","+email+","+office;
	
	alert(theData);
	
/*	$.ajax({
		  type: "POST",
		  url: "rest/user",
		  data: theData,
		  cache: false,
		  success: function(data){*/
		    // $("#resultarea").text("Register success: "+data);
		     $( "#registerDiv" ).hide();
		     $( "#productsDiv" ).show();
/*		  }
		});*/
		$( "#title" ).text("Crear pedido");
 });
 
 $( "#addProduct" ).click(function() {
	
	 $( "#productsDiv" ).hide();
     $( "#productDiv" ).show();

	$( "#title" ).text("Agregar producto");
 });
 
 $( "#add" ).click(function() {
	 
	 var product = $("#product");
	 var productName = $("option:selected", product).text();
	 var productId = product.val();
	 
	 var unit = $("#unit").val();
	 var amount = $("#amount").val();
	 var obs = $("#obs").val();
	 $("#products").append('<li><input type="hidden" name="productsItem" value="'+productId+","+unit+","+amount+","+obs+'">'+productName+" "+unit+" "+amount+" "+obs+' <input type="button" value="-" onclick="deleteItem(this);" /></li>');
	 i++;
	 $( "#productsDiv" ).show();
     $( "#productDiv" ).hide();
	 $( "#title" ).text("Crear pedido");
	
 });
 
 $( "#send" ).click(function() {
	 var order = officeId+","+userId+";";
	 $('[name="productsItem"]').each(function() {
		  order = order + $( this ).val() + ";";
		});
	 
	 order = userId+","+officeId+","+"1"+":"+order;
	 
	 alert(order);
	 
	 $.ajax({
		  type: "POST",
		  url: "rest/saveOrder",
		  data: order,
		  cache: false,
		  success: function(data){
		     $("#resultarea").text("Register success: "+data);
		  }
		});
	 
  });
  
 
});

function deleteItem(item) {
	 alert(item);
	 $(item).parent().remove();
}
</script>
<script>
// Toggle between showing and hiding the sidebar, and add overlay effect
function Appmenu_open() {

// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    if (mySidebar.style.display === 'block') {
        mySidebar.style.display = 'none';
        overlayBg.style.display = "none";
    } else {
        mySidebar.style.display = 'block';
        overlayBg.style.display = "block";
    }
}

// Close the sidebar with the close button
function Appmenu_close() {
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
}


function Appmenu_gomyprofile() {
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
	$( "#loginDiv" ).hide();
	$( "#productDiv" ).hide();
    $( "#productsDiv" ).hide();
    $( "#registerDiv" ).show();
}

function Appmenu_gomyorders() {
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
	$( "#loginDiv" ).hide();
	$( "#productDiv" ).hide();
    $( "#productsDiv" ).hide();
    $( "#registerDiv" ).hide();
}

function Appmenu_gomylist() {
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
	$( "#loginDiv" ).hide();
	$( "#registerDiv" ).hide();
	$( "#productDiv" ).hide();
    $( "#productsDiv" ).show();
}

function Appmenu_gomylocation() {
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
	$( "#loginDiv" ).hide();
	$( "#registerDiv" ).hide();
	$( "#productDiv" ).hide();
    $( "#productsDiv" ).hide();
}

function Appmenu_gohelp() {
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
	$( "#loginDiv" ).hide();
	$( "#registerDiv" ).hide();
	$( "#productDiv" ).hide();
    $( "#productsDiv" ).hide();
}
</script>

</head>
<body>
	<div id="initScreen">
		<img src="Salata.png" alt="Logo" style="width:60%;position:absolute;top:20%;left:20%;">
	</div>
	<header>
		<!-- Navbar -->
		<div class="AppO-top" id="headerBar">
  			<div class="AppO-bar AppO-theme AppO-top AppO-left-align AppO-large">
		    		<a class="AppO-bar-item AppO-button AppO-left AppO-large" href="javascript:void(0)" onclick="Appmenu_open()">
		    			<i class="fa fa-bars">
		    				::before
		    			</i>
		    		</a>
		    		<a class="AppO-bar-item" id="title">Iniciar Sesi&oacute;n</a>
  			</div>
		</div>

		<!-- Sidebar -->
		<nav class="AppO-sidebar AppO-bar-block AppO-collapse AppO-medium AppO-theme-l5 AppO-animate-left" id="mySidebar">
	  		<a href="javascript:void(0)" onclick="Appmenu_close()" class="AppO-right AppO-xlarge AppO-padding-large" title="Close Menu">
	    	<i class="fa fa-remove"></i>
	  		</a>
			  <h4 class="AppO-bar-item"><b>Menu</b></h4>
			  <a class="AppO-bar-item AppO-button" href="javascript:void(0)" onclick="Appmenu_gomyprofile()">Mi Perfil</a>
			  <a class="AppO-bar-item AppO-button" href="javascript:void(0)" onclick="Appmenu_gomyorders()">Mis Pedidos</a>
			  <a class="AppO-bar-item AppO-button" href="javascript:void(0)" onclick="Appmenu_gomylist()">Pedido de hoy</a>
			  <a class="AppO-bar-item AppO-button" href="javascript:void(0)" onclick="Appmenu_gomylocation()">Registrar Ubicaci&oacute;n</a>
			  <br>
			  <br>
			  <br>
			  <a class="AppO-bar-item AppO-button" href="javascript:void(0)" onclick="Appmenu_gohelp()">Ayuda</a>
		</nav>

		<!-- Overlay effect when opening sidebar on small screens -->
		<div class="AppO-overlay" onclick="Appmenu_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>
	</header>
	<div id="loginDiv" class="center-container">		
		<br>
		<br>
		<br>
		<br>
		<input type="text" name="username" id="username" placeholder="Usuario">
		<br>
		<input type="password" name="password" id="password" placeholder="Contrase&ntilde;a">
		<br>
		<br>
		<button type="button" id="login">Entrar</button>
		<br>
		<br>
		<button type="button" id="register">Registrarse</button>
	</div>
	<div id="registerDiv"  class="center-container">
		<br>
		<br>
		<br>
		<input type="text" name="idUser" id="idUser" placeholder="C&eacute;dula">
		<br>
		<input type="password" name="pass" id="pass" placeholder="Contrase&ntilde;a nueva">
		<br>
		<input type="password" name="conPass" id="conPass" placeholder="Confirmar Contrase&ntilde;a">
		<br>
		<input type="text" name="idEmpRecep" id="idEmpRecep" placeholder="NIT o CC destinatario">
		<br>
		<a class="AppO-tiny">*Sin digito de verificaci&oacute;n</a>
		<br>
		<input type="password" name="passEmpRecep" id="passEmpRecep" placeholder="Contrase&ntilde;a destinatario">
		<br>
		<select name="office" id="office"> <option value="1">ejemplo</option> </select>
		<br>
		<input type="text" name="cellphone" id="cellphone" placeholder="Celular">
		<br>
		<input type="text" name="phone" id="phone" placeholder="Tel&eacute;fono">
		<br>
		<input type="text" name="email" id="email" placeholder="Correo">
		<br>
		<button type="button" id="submitRegister">Registro</button>
	</div>
	<div id="productsDiv">
		<br>
		<br>
		<br>
		<br>
		Agregar producto: <button type="button" id="addProduct" >+</button>
		
		<ol id="products">
		</ol>
		
		<button type="button" id="send">Enviar</button>
	</div>
	<div id="productDiv" class="center-container">
		<br>
		<br>
		<br>
		<br>
		<input type="text" name="productName" id="productName" placeholder="Producto">
		<select name="product" id="product"> <option value="1">limon</option> </select>
		<br>
		Unidad: <select name="unit" id="unit"> <option value="kg">kg</option>  <option value="und">und</option></select>
		Cantidad: <input type="text" name="amount" id="amount">
		<br>
		<input type="text" name="obs" id="obs" placeholder="Observaciones">
		<br>
		<button type="button" id="add">Agregar</button>
	</div>
	<div id="resultarea"></div>
</body>
</html>
