<html>
<head>
<link rel="stylesheet" type="text/css" href="orderscont.css">
<style>
</style>
<script src="jquery-3.3.1.min.js"></script>
<script>
$( document ).ready(function() {
	
var userId = "";
var officeId = "";
	
var i = 0;
var myusername = $("#username").val();
$.ajax({
  type: "GET",
  url: "rest/companies",
  data: myusername,
  cache: false,
  success: function(data){
     $("#resultarea").text(data);
  }
});

var x = document.getElementsByTagName("BODY")[0];
x.style.backgroundColor = "#F5F5E7";

$( "#loginDiv" ).hide();
$( "#registerDiv" ).hide();
$( "#productsDiv" ).hide();
$( "#productDiv" ).hide();

setTimeout(function() {
	x.style.backgroundColor = "white";
	$( "#initScreen" ).hide();
	$( "#loginDiv" ).show();
}, 1500);


$( "#login" ).click(function() {
	var username = $("#username").val();
	var password = $("#password").val();
	var theData = username+","+password;
	$.ajax({
		  type: "GET",
		  url: "rest/user",
		  data: "data="+theData,
		  cache: false,
		  success: function(data){
		     $("#resultarea").text(data);
		     if (data == "failed") {
		    	 	$("#resultarea").text("El usuario no existe");
		     } else {
		    	    var array = data.split(',')
		    	 	userId = array[0];
		    	    officeId = array[1];
		    		$( "#loginDiv" ).hide();
		    		$( "#productsDiv" ).show();
		     }
		  }
		});
});
	
$( "#register" ).click(function() {
	$( "#loginDiv" ).hide();
	$( "#registerDiv" ).show();
});

$( "#submitRegister" ).click(function() {

	var company = $("#company").val();
	var user = $("#user").val();
	var phone = $("#phone").val();
	var email = $("#email").val();
	var theData = "{"+company+","+user+","+phone+","+email+"}";
	
	alert(theData);
	
	$.ajax({
		  type: "POST",
		  url: "rest/register",
		  data: theData,
		  cache: false,
		  success: function(data){
		     $("#resultarea").text("Register success: "+data);
		     $( "#registerDiv" ).hide();
		     $( "#productsDiv" ).show();
		  }
		});
 });
 
 $( "#addProduct" ).click(function() {
	
	 $( "#productsDiv" ).hide();
     $( "#productDiv" ).show();

	
 });
 
 $( "#add" ).click(function() {
	 
	 var product = $("#product");
	 var productName = $("option:selected", product).text();
	 var productId = product.val();
	 
	 var unit = $("#unit").val();
	 var amount = $("#amount").val();
	 var obs = $("#obs").val();
	 $("#products").append('<li><input type="hidden" name="productsItem" value="'+productId+","+unit+","+amount+","+obs+'">'+productName+" "+unit+" "+amount+" "+obs+' <input type="button" value="-" onclick="deleteItem(this);" /></li>');
	 i++;
	 $( "#productsDiv" ).show();
     $( "#productDiv" ).hide();

	
 });
 
 $( "#send" ).click(function() {
	 var order = officeId+","+userId+";";
	 $('[name="productsItem"]').each(function() {
		  order = order + $( this ).val() + ";";
		});
	 
	 order = userId+","+officeId+","+"1"+":"+order;
	 
	 alert(order);
	 
	 $.ajax({
		  type: "POST",
		  url: "rest/saveOrder",
		  data: order,
		  cache: false,
		  success: function(data){
		     $("#resultarea").text("Register success: "+data);
		  }
		});
	 
  });
  
 
});

function deleteItem(item) {
	 alert(item);
	 $(item).parent().remove();
}
</script>
<script>
// Toggle between showing and hiding the sidebar, and add overlay effect
function Appmenu_open() {

// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    if (mySidebar.style.display === 'block') {
        mySidebar.style.display = 'none';
        overlayBg.style.display = "none";
    } else {
        mySidebar.style.display = 'block';
        overlayBg.style.display = "block";
    }
}

// Close the sidebar with the close button
function Appmenu_close() {
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
}
</script>

</head>
<body>
	<div id="initScreen">
		<img src="Salata.png" alt="Logo" style="width:60%;position:absolute;top:20%;left:20%;">
	</div>
	<div id="loginDiv" class="center-container">
		<header>
		<!-- Navbar -->
		<div class="AppO-top">
  			<div class="AppO-bar AppO-theme AppO-top AppO-left-align AppO-large">
    		<a class="AppO-bar-item AppO-button AppO-left AppO-large" href="javascript:void(0)" onclick="Appmenu_open()">
    			<i class="fa fa-bars"></i>
    		</a>
    		<a class="AppO-bar-item">Iniciar Sesi&oacute;n</a>
  			</div>
		</div>

		<!-- Sidebar -->
		<nav class="AppO-sidebar AppO-bar-block AppO-collapse AppO-large AppO-theme-l5 AppO-animate-left" id="mySidebar">
	  		<a href="javascript:void(0)" onclick="Appmenu_close()" class="AppO-right AppO-xlarge AppO-padding-large" title="Close Menu">
	    	<i class="fa fa-remove"></i>
	  		</a>
			  <h4 class="AppO-bar-item"><b>Menu</b></h4>
			  <a class="AppO-bar-item AppO-button" href="#">Inicio</a>
			  <a class="AppO-bar-item AppO-button" href="#">Mi Perfil</a>
			  <a class="AppO-bar-item AppO-button" href="#">Mis Pedidos</a>
			  <a class="AppO-bar-item AppO-button" href="#">Pedido de hoy</a>
			  <a class="AppO-bar-item AppO-button" href="#">Registrar Ubicaci&oacute;n</a>
			  <br>
			  <br>
			  <br>
			  <a class="AppO-bar-item AppO-button" href="#">Ayuda</a>
		</nav>

		<!-- Overlay effect when opening sidebar on small screens -->
		<div class="AppO-overlay" onclick="Appmenu_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>
		</header>
		<br>
		<br>
		<br>
		<br>
		<input type="text" name="username" id="username" placeholder="Usuario">
		<br>
		<input type="text" name="password" id="password" placeholder="Contrase&ntilde;a">
		<br>
		<br>
		<button type="button" id="login">Entrar</button>
		<br>
		<br>
		<button type="button" id="register">Registrarse</button>
	</div>
	<div id="registerDiv">
		Nombre de la empresa: <input type="text" name="company" id="company">
		Usuario: <input type="text" name="user" id="user">
		Telefono: <input type="text" name="phone" id="phone">
		Email: <input type="text" name="email" id="email">
		<button type="button" id="submitRegister">Registro</button>
	</div>
	<div id="productsDiv">
		Agregar producto: <button type="button" id="addProduct">+</button>
		
		<ol id="products">
		</ol>
		
		<button type="button" id="send">Enviar</button>
	</div>
	<div id="productDiv">
		Producto: <input type="text" name="productName" id="productName">
		<select name="product" id="product"> <option value="1">limon</option> </select>
		
		Unidad: <select name="unit" id="unit"> <option value="kg">kg</option>  <option value="und">und</option></select>
		Cantidad: <input type="text" name="amount" id="amount">
		Observaciones: <input type="text" name="obs" id="obs">
		<button type="button" id="add">Agregar</button>
	</div>
	<div id="resultarea"></div>
</body>
</html>
